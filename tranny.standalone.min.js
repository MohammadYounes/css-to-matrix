!function(a,b){"object"==typeof exports?module.exports=b():"function"==typeof define&&define.amd?define([],b):a.annie=b()}(this,function(){"use strict";function a(a,b){return function(){a.apply(b,[].slice.call(arguments))}}function b(a,b){return(a.currentStyle||getComputedStyle(a))[b]}var c=document,d=navigator,e=window,f={};return f.ie=d.appVersion.search("MSIE")>-1?parseInt(d.appVersion.slice(22,26),10):!1,f.performance=!(!e.performance||!e.performance.now),f.vendor=function(){if(f.ie&&f.ie<9)return"ms";var a,b,d,e=" O ms Moz Webkit".split(" "),g=c.body.style;for(a=e.length;a--;)if(b=e[a],d=""!==b?b+"Transform":"transform",void 0!==g[d])return b}(),f.requestAnimationFrame=a(e.requestAnimationFrame||e[f.vendor+"RequestAnimationFrame"]||function(){var a=0;return function(b){var c=+new Date,d=Math.max(0,16-(c-a)),e=setTimeout(function(){b(c+d)},d);return a=c+d,e}}(),e),f.cancelAnimationFrame=a(e.cancelAnimationFrame||e.cancelRequestAnimationFrame||e[f.vendor+"CancelAnimationFrame"]||e[f.vendor+"CancelRequestAnimationFrame"]||clearTimeout,e),f.transform=function(){var a=f.vendor+"Transform";return void 0!==c.body.style[a]?a:void 0}(),f["3d"]=function(){var a=f.transform;if(!a)return!1;var d=c.body,e=c.createElement("p");e.style[a]="translate3d(1px,1px,1px)",d.appendChild(e);var g=b(e,a);return d.removeChild(e),void 0!==g&&"none"!==g&&g.length>0}(),f}),function(){var a;a=function(a){return"object"==typeof exports?module.exports=a:"function"==typeof define&&define.amd?define([],a):this["matrix-utilities"]=a},a({multiply:function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n;if(a[0].length!==b.length)throw new Error("Matrix 1's row count should equal matrix 2's column count");for(h=a[0].length,f=[],c=k=0,m=b.length;m>k;c=++k)for(g=b[c],f[c]=[],d=l=0,n=g.length;n>l;d=++l){for(j=g[d],e=h,i=0;e--;)i+=a[c][e]*b[e][d];f[c][d]=i}return f},flip:function(a){var b,c,d,e,f,g,h,i,j;for(d=[],b=g=0,i=a.length;i>g;b=++g)for(e=a[b],c=h=0,j=e.length;j>h;c=++h)f=e[c],(d[c]||(d[c]=[]))[b]=f;return d},to2d:function(a){return[[a[0][0]||1,a[0][1]||0,a[0][3]||0],[a[1][0]||0,a[1][1]||1,a[1][3]||0]]},to3d:function(a){return[[a[0][0]||1,a[0][1]||0,0,a[0][2]||0],[a[1][0]||0,a[1][1]||1,0,a[1][2]||0],[0,0,1,0],[0,0,0,1]]},Identity:function(){return[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]]}})}.call(this),function(){var a,b;b=function(a){return"object"==typeof exports?module.exports=a:"function"==typeof define&&define.amd?define([],a):this["transform-to-matrix"]=a},a={perspective:function(a){return[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,-1/a,1]]},rotate:function(b){return a.rotateZ(b)},rotateX:function(b){return a.rotate3d(1,0,0,b)},rotateY:function(b){return a.rotate3d(0,1,0,b)},rotateZ:function(a){var b,c;return b=Math.cos(a),c=Math.sin(a),[[b,-c,0],[c,b,0]]},rotate3d:function(a,b,c,d){var e,f,g,h,i;return i=a*a+b*b+c*c,e=Math.cos(d),g=Math.sin(d),f=1-e,h=Math.sqrt(i)*g,[[(a*a+(b*b+c*c)*e)/i,(a*b*f-c*h)/i,(a*c*f+b*h)/i,0],[(a*b*f+c*h)/i,(b*b+(a*a+c*c)*e)/i,(b*c*f-a*h)/i,0],[(a*c*f-b*h)/i,(b*c*f+a*h)/i,(c*c+(a*a+b*b)*e)/i,0],[0,0,0,1]]},scale:function(a,b){return[[a,0,0],[0,b,0]]},scaleX:function(b){return a.scale(b,1)},scaleY:function(b){return a.scale(1,b)},scaleZ:function(b){return a.scale3d(1,1,b)},scale3d:function(a,b,c){return[[a,0,0,0],[0,b,0,0],[0,0,c,0],[0,0,0,1]]},skew:function(a,b){return[[1,Math.tan(a),0],[Math.tan(b),1,0]]},skewX:function(a){return[[1,Math.tan(a),0],[0,1,0]]},skewY:function(a){return[[1,0,0],[Math.tan(a),1,0]]},translate:function(a,b){return[[1,0,a],[0,1,b]]},translateX:function(b){return a.translate(b,0)},translateY:function(b){return a.translate(0,b)},translateZ:function(b){return a.translate3d(0,0,b)},translate3d:function(a,b,c){return[[1,0,0,a],[0,1,0,b],[0,0,1,c],[0,0,0,1]]}},b(a)}.call(this),function(){var a,b,c,d={}.hasOwnProperty;c={extend:function(a,b){var c;for(c in b)d.call(b,c)&&(a[c]=b[c]);return a},trim:function(){var a,b;return"".trim?function(a){return a.trim()}:(a=/^\s\s*/,b=/\s\s*$/,function(c){return c.replace(a,"").replace(b,"")})}()},a=function(){function a(a,b){this._data=null!=a?a:{},this.options={separator:"/"},b&&c.extend(this.options,b),this.events={}}return a.prototype.get=function(a){return this.trigger("get",a),this._get(this._split(a))},a.prototype.set=function(a,b){return this.trigger("set",a,b),this._set(this._split(a),b)},a.prototype.setnx=function(a,b){return this.trigger("setnx",a,b),this._set(this._split(a),b,!0)},a.prototype.on=function(a,b){var c,d;if(b)return this._on(a,b);d=[];for(c in a)b=a[c],d.push(this._on(c,b));return d},a.prototype.trigger=function(a,b,c){var d,e,f,g,h;if(null==b&&(b="*"),b=this._normalize(b),a in this.events){g=this.events[a],h=[];for(d in g)f=g[d],"*"===d||0===(b+"/").indexOf(d+"/")?h.push(function(){var a,d,g;for(g=[],a=0,d=f.length;d>a;a++)e=f[a],g.push(e.call(this,b,c,this));return g}.call(this)):h.push(void 0);return h}},a.prototype._get=function(a,b,c){var d;if(null==b&&(b=this._data),null==c&&(c=[]),d=a.shift()){if(!(d in b))throw new Error('get: key "'+d+'" does not exist in "'+c.join("/")+'"');return c.push(d),this._get(a,b[d],c)}return b},a.prototype._set=function(a,b,c,d,e){var f;return null==c&&(c=!1),null==d&&(d=this._data),null==e&&(e=[]),f=a.shift(),a.length?(f in d||(d[f]={}),e.push(f),this._set(a,b,c,d[f],e)):c&&f in d?void 0:d[f]=b},a.prototype._on=function(a,b){var d,e,f,g,h,i,j;for(f=a.split(":"),e=f[0].split(" "),g=this._normalize(f[1]||"*"),j=[],h=0,i=e.length;i>h;h++)d=e[h],d=c.trim(d),d in this.events||(this.events[d]={}),g in this.events[d]||(this.events[d][g]=[]),j.push(this.events[d][g].push(b));return j},a.prototype._normalize=function(a){var b;return b=this.options.separator,a=c.trim(a),a.charAt(0)===b&&(a=a.slice(1)),a.charAt(a.length-1)===b&&(a=a.slice(0,-1)),a},a.prototype._split=function(a){return this._normalize(a).split(this.options.separator)},a}(),b=function(a,b){return"object"==typeof exports?module.exports=b:"function"==typeof define&&define.amd?define(a,[],function(){return b}):this[a]=b},b("umodel",a)}.call(this),function(){var a,b,c={}.hasOwnProperty;b=function(a,b,d){var e,f;return f={rad:function(a){var b,c;return"string"==typeof a&&(b=parseFloat(a,10),c=a.indexOf(!1),c&&(b*=Math.PI/180),a=b),a},copy:function(a){return a.slice()},extend:function(a,b){var d;for(d in b)c.call(b,d)&&(a[d]=b[d]);return a},fluent:function(a){return function(){return a.apply(this,arguments),this}}},e=function(){function c(c){this.model=new b({matrix:new a.Identity,transformations:{perspective:new a.Identity,rotate:new a.Identity,scale:new a.Identity,skew:new a.Identity,translate:new a.Identity}}),c&&this.matrix(c)}return c.prototype.matrix=function(a){var b,c;if(c=a.length,b=c>0?c:0,4!==c||4!==b)throw new Error("expected parameter `data` to be a 4x4 matrix of arrays, but was given a "+c+"x"+b+" matrix");return this.model.set("matrix",a)},c.prototype.getMatrix=function(){var b,c;return b=this.model.get("matrix"),c=this.model.get("transformations"),b=a.multiply(b,c.perspective),b=a.multiply(b,c.translate),b=a.multiply(b,c.rotate),b=a.multiply(b,c.skew),b=a.multiply(b,c.scale),a.flip(b)},c.prototype.getMatrixCSS=function(){var a,b,c,d,e,f,g,h;for(c=this.getMatrix(),a=[],e=0,g=c.length;g>e;e++)for(d=c[e],f=0,h=d.length;h>f;f++)b=d[f],a.push(b);return"matrix3d("+a.join(",")+")"},c.prototype.rotate=function(a){return this.rotateZ(a)},c.prototype.rotateX=function(a){return this.rotate3d(1,0,0,a)},c.prototype.rotateY=function(a){return this.rotate3d(0,1,0,a)},c.prototype.rotateZ=function(a){return this.rotate3d(0,0,1,a)},c.prototype.scale=function(a,b){return this.scale3d(a,b)},c.prototype.scaleX=function(a){return this.scale3d(a)},c.prototype.scaleY=function(a){return null==a&&(a=1),this.scale3d(null,a)},c.prototype.scaleZ=function(a){return null==a&&(a=1),this.scale3d(null,null,a)},c.prototype.skewX=function(a){return this.skew(a)},c.prototype.skewY=function(a){return this.skew(null,a)},c.prototype.translate=function(a,b){return this.translate3d(a,b)},c.prototype.translateX=function(a){return this.translate3d(a)},c.prototype.translateY=function(a){return null==a&&(a=0),this.translate3d(null,a)},c.prototype.translateZ=function(a){return null==a&&(a=0),this.translate3d(null,null,a)},c.prototype.perspective=f.fluent(function(a){return null==a&&(a=0),this.model.set("transformations/perspective",d.perspective(a))}),c.prototype.rotate3d=f.fluent(function(a,b,c,e){return null==a&&(a=0),null==b&&(b=0),null==c&&(c=0),null==e&&(e=0),this.model.set("transformations/rotate",d.rotate3d(a,b,c,f.rad(e)))}),c.prototype.scale3d=f.fluent(function(a,b,c){return null==a&&(a=1),null==b&&(b=1),null==c&&(c=1),this.model.set("transformations/scale",d.scale3d(a,b,c))}),c.prototype.skew=f.fluent(function(b,c){return null==b&&(b=0),null==c&&(c=0),this.model.set("transformations/skew",a.to3d(d.skew(f.rad(b),f.rad(c))))}),c.prototype.translate3d=f.fluent(function(a,b,c){return null==a&&(a=0),null==b&&(b=0),null==c&&(c=0),this.model.set("transformations/translate",d.translate3d(a,b,c))}),c}()},a=function(a,b){return"object"==typeof exports?module.exports=b(require("matrix-utilities"),require("umodel"),require("transform-to-matrix")):"function"==typeof define&&define.amd?define(a,["matrix-utilities","umodel","transform-to-matrix"],b):this[a]=b(this["matrix-utilities"],this.umodel,this["transform-to-matrix"])},a("Tranny",b)}.call(this);